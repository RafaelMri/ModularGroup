(* Content-type: application/vnd.wolfram.mathematica *)

(*** Wolfram Notebook File ***)
(* http://www.wolfram.com/nb *)

(* CreatedBy='Mathematica 9.0' *)

(*CacheID: 234*)
(* Internal cache information:
NotebookFileLineBreakTest
NotebookFileLineBreakTest
NotebookDataPosition[       157,          7]
NotebookDataLength[     11389,        254]
NotebookOptionsPosition[     11051,        238]
NotebookOutlinePosition[     11414,        254]
CellTagsIndexPosition[     11371,        251]
WindowFrame->Normal*)

(* Beginning of Notebook Content *)
Notebook[{
Cell[BoxData[
 RowBox[{
  RowBox[{"Protect", "[", 
   RowBox[{
   "Class", ",", "BaseClasses", ",", "Methods", ",", "InstanceQ", ",", 
    "EffectiveInstanceQ"}], "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.579367189395546*^9, 3.579367213721757*^9}, {
  3.579367292908407*^9, 3.5793672956684475`*^9}, {3.579368723012206*^9, 
  3.579368723720216*^9}, {3.5793710446264524`*^9, 3.579371047892511*^9}, {
  3.579371230908052*^9, 3.5793712313290586`*^9}, {3.579373325723061*^9, 
  3.5793733258550634`*^9}, {3.5793769150487165`*^9, 3.5793769153807187`*^9}, {
  3.579376975669227*^9, 3.5793769848172927`*^9}, {3.579412211225275*^9, 
  3.579412211381275*^9}, {3.579413030465232*^9, 3.5794130471583004`*^9}, {
  3.5794139260397024`*^9, 3.5794139351345396`*^9}}],

Cell[BoxData[
 RowBox[{
  RowBox[{"ClearAll", "[", 
   RowBox[{
   "NewClass", ",", " ", "AddMethod", ",", " ", "AddSuper", ",", " ", "New"}],
    "]"}], ";"}]], "Input",
 CellChangeTimes->{{3.5793705596172056`*^9, 3.57937057674444*^9}, {
   3.5793720869653144`*^9, 3.579372090763353*^9}, {3.5794015679978514`*^9, 
   3.579401569355057*^9}, 3.5794038877585626`*^9, {3.5794122217719183`*^9, 
   3.5794122341281686`*^9}}],

Cell[BoxData[{
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"NewClass", "[", "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "classObj", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"Class", "[", "classObj", "]"}], "^=", "Class"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"BaseClasses", "[", "classObj", "]"}], "^=", 
        RowBox[{"{", "classObj", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"Methods", "[", "classObj", "]"}], "^=", 
        RowBox[{"{", "}"}]}], ";", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"InstanceQ", "[", "classObj", "]"}], "^=", 
        RowBox[{
         RowBox[{"MemberQ", "[", 
          RowBox[{
           RowBox[{"BaseClasses", "[", "classObj", "]"}], ",", 
           RowBox[{"Class", "[", "#", "]"}]}], "]"}], "&"}]}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"AddMethod", "[", 
        RowBox[{"classObj", ",", "EffectiveClass", ",", 
         RowBox[{
          RowBox[{"Class", "[", "#", "]"}], "&"}]}], "]"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"EffectiveInstanceQ", "[", "classObj", "]"}], "^=", 
        RowBox[{
         RowBox[{"MemberQ", "[", 
          RowBox[{
           RowBox[{"BaseClasses", "[", "classObj", "]"}], ",", 
           RowBox[{"EffectiveClass", "[", "#", "]"}]}], "]"}], "&"}]}], ";", 
       "\[IndentingNewLine]", "classObj"}]}], "\[IndentingNewLine]", "]"}]}], 
   ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"AddMethod", "[", 
     RowBox[{"classObj_", ",", "method_", ",", "function_"}], "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{"Unprotect", "[", "method", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"If", "[", 
       RowBox[{
        RowBox[{"method", "===", "EffectiveClass"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"method", "[", 
          RowBox[{
           RowBox[{"obj_", "?", 
            RowBox[{"(", 
             RowBox[{"InstanceQ", "[", "classObj", "]"}], ")"}]}], ",", 
           "args___"}], "]"}], ":=", 
         RowBox[{"function", "[", 
          RowBox[{"obj", ",", "args"}], "]"}]}], ",", "\[IndentingNewLine]", 
        RowBox[{
         RowBox[{"method", "[", 
          RowBox[{
           RowBox[{"obj_", "?", 
            RowBox[{"(", 
             RowBox[{"EffectiveInstanceQ", "[", "classObj", "]"}], ")"}]}], 
           ",", "args___"}], "]"}], ":=", 
         RowBox[{"function", "[", 
          RowBox[{"obj", ",", "args"}], "]"}]}]}], "\[IndentingNewLine]", 
       "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Protect", "[", "method", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{"Methods", "[", "classObj", "]"}], "^=", 
       RowBox[{"Append", "[", 
        RowBox[{
         RowBox[{"DeleteCases", "[", 
          RowBox[{
           RowBox[{"Methods", "[", "classObj", "]"}], ",", 
           RowBox[{"{", 
            RowBox[{"method", ",", "_"}], "}"}]}], "]"}], ",", 
         RowBox[{"{", 
          RowBox[{"method", ",", "function"}], "}"}]}], "]"}]}]}], 
     "\[IndentingNewLine]", ")"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"AddSuper", "[", 
     RowBox[{"class_", ",", "super_"}], "]"}], ":=", 
    RowBox[{"(", "\[IndentingNewLine]", 
     RowBox[{
      RowBox[{
       RowBox[{"BaseClasses", "[", "super", "]"}], "^=", 
       RowBox[{"Append", "[", 
        RowBox[{
         RowBox[{"BaseClasses", "[", "super", "]"}], ",", "class"}], "]"}]}], 
      ";", "\[IndentingNewLine]", 
      RowBox[{"Do", "[", "\[IndentingNewLine]", 
       RowBox[{
        RowBox[{"AddMethod", "[", 
         RowBox[{"class", ",", 
          RowBox[{"m", "[", 
           RowBox[{"[", "1", "]"}], "]"}], ",", 
          RowBox[{"m", "[", 
           RowBox[{"[", "2", "]"}], "]"}]}], "]"}], ",", 
        "\[IndentingNewLine]", 
        RowBox[{"{", 
         RowBox[{"m", ",", 
          RowBox[{"Methods", "[", "super", "]"}]}], "}"}]}], 
       "\[IndentingNewLine]", "]"}], ";", "\[IndentingNewLine]", 
      RowBox[{"Methods", "[", "class", "]"}]}], "\[IndentingNewLine]", 
     ")"}]}], ";"}], "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{
    RowBox[{"New", "[", 
     RowBox[{"classObj_", ",", "initArgs___"}], "]"}], ":=", 
    RowBox[{"Module", "[", 
     RowBox[{
      RowBox[{"{", "obj", "}"}], ",", "\[IndentingNewLine]", 
      RowBox[{
       RowBox[{
        RowBox[{"Class", "[", "obj", "]"}], "^=", "classObj"}], ";", 
       "\[IndentingNewLine]", 
       RowBox[{"classObj", "[", 
        RowBox[{"obj", ",", "initArgs"}], "]"}], ";", "\[IndentingNewLine]", 
       "obj"}]}], "\[IndentingNewLine]", "]"}]}], ";"}], 
  "\[IndentingNewLine]"}], "\[IndentingNewLine]", 
 RowBox[{
  RowBox[{
   RowBox[{"Info", "[", "obj_", "]"}], ":=", 
   RowBox[{"Information", "@", 
    RowBox[{"Evaluate", "@", "obj"}]}]}], ";"}]}], "Input",
 CellChangeTimes->{{3.579365487198738*^9, 3.5793655820555935`*^9}, {
   3.5793656333079348`*^9, 3.5793658248834763`*^9}, {3.5793659074392147`*^9, 
   3.5793659077402225`*^9}, {3.57936607314459*^9, 3.5793661673864717`*^9}, {
   3.5793663575438347`*^9, 3.5793664458386*^9}, {3.579366527579216*^9, 
   3.5793665913097553`*^9}, {3.579366673172308*^9, 3.5793666733243103`*^9}, {
   3.5793667468979516`*^9, 3.5793667497279882`*^9}, {3.579366908721119*^9, 
   3.5793669138091607`*^9}, {3.5793669729655924`*^9, 
   3.5793669917357845`*^9}, {3.579367128440999*^9, 3.579367197992635*^9}, {
   3.579367386926221*^9, 3.5793673876292343`*^9}, {3.5793674209404764`*^9, 
   3.579367545184757*^9}, {3.5793678360042124`*^9, 3.579367868720496*^9}, {
   3.5793686705516233`*^9, 3.5793686718676357`*^9}, {3.5793690231075706`*^9, 
   3.579369074243022*^9}, {3.579369109514309*^9, 3.5793692033332386`*^9}, {
   3.5793692432225385`*^9, 3.5793693487046185`*^9}, {3.5793694908377395`*^9, 
   3.579369523672062*^9}, {3.5793696015187435`*^9, 3.5793696098628464`*^9}, {
   3.5793702481250896`*^9, 3.5793702580592127`*^9}, {3.57937032618388*^9, 
   3.579370465379341*^9}, {3.579370516668772*^9, 3.5793705850835285`*^9}, {
   3.579370869048667*^9, 3.5793710325613236`*^9}, {3.579371098675929*^9, 
   3.579371139783332*^9}, {3.579371214528867*^9, 3.5793712246520057`*^9}, {
   3.5793718345919647`*^9, 3.5793718379240103`*^9}, {3.579371898470416*^9, 
   3.579371938669797*^9}, {3.579372202821478*^9, 3.579372217776619*^9}, {
   3.579372340768742*^9, 3.579372357481922*^9}, {3.579372548310812*^9, 
   3.579372548962818*^9}, {3.579373084070772*^9, 3.57937308995986*^9}, {
   3.5793741970196705`*^9, 3.5793742254899564`*^9}, {3.5793754570640855`*^9, 
   3.579375464644142*^9}, {3.5793755156675377`*^9, 3.579375554888816*^9}, {
   3.5793757567925625`*^9, 3.579375758981579*^9}, {3.5793760817050047`*^9, 
   3.579376083651019*^9}, {3.5793761532766724`*^9, 3.5793761764238596`*^9}, {
   3.579376249769552*^9, 3.579376251077563*^9}, {3.579376486814251*^9, 
   3.5793766304213495`*^9}, {3.579376669025691*^9, 3.5793767011589556`*^9}, {
   3.579376774937537*^9, 3.57937677669355*^9}, 3.579376853307109*^9, 
   3.579376971590199*^9, {3.579377006771456*^9, 3.579377025460601*^9}, {
   3.5793775474686966`*^9, 3.5793775699039087`*^9}, {3.5793776296404285`*^9, 
   3.579377641175534*^9}, {3.579377688720945*^9, 3.5793776908789635`*^9}, 
   3.579377807092782*^9, {3.5793778607141795`*^9, 3.579377865580221*^9}, {
   3.579401510839217*^9, 3.5794016390405426`*^9}, {3.579402407203298*^9, 
   3.5794024138645253`*^9}, {3.579402447919465*^9, 3.57940244919867*^9}, 
   3.5794029281986322`*^9, {3.579402964655981*^9, 3.579402995887309*^9}, {
   3.5794039362435613`*^9, 3.579403977942532*^9}, {3.5794040091114597`*^9, 
   3.579404241911213*^9}, {3.579404288508604*^9, 3.579404322766344*^9}, {
   3.579404399795871*^9, 3.579404406347898*^9}, {3.579404438874031*^9, 
   3.579404514471941*^9}, {3.5794045915674562`*^9, 3.579404607853923*^9}, {
   3.5794048185327864`*^9, 3.5794051794090643`*^9}, {3.579405213011602*^9, 
   3.5794052750218563`*^9}, {3.5794058414601765`*^9, 
   3.5794058885879693`*^9}, {3.5794059204276996`*^9, 
   3.5794059628442736`*^9}, {3.579406054291848*^9, 3.579406132650969*^9}, {
   3.5794066132109375`*^9, 3.5794066440366635`*^9}, {3.5794066993076897`*^9, 
   3.5794067519267054`*^9}, {3.5794067826120315`*^9, 3.57940684574549*^9}, {
   3.579407360405603*^9, 3.579407360873605*^9}, {3.579407600927388*^9, 
   3.579407602003793*^9}, {3.5794082711685333`*^9, 3.5794082720889373`*^9}, {
   3.57940958865633*^9, 3.5794095889683313`*^9}, {3.5794100356761613`*^9, 
   3.579410100900028*^9}, {3.5794120492704096`*^9, 3.5794120505184145`*^9}, {
   3.579412090129977*^9, 3.579412134699961*^9}, 3.5794121669472933`*^9, {
   3.579412726442786*^9, 3.579412986734253*^9}, {3.579413061885761*^9, 
   3.579413071870802*^9}, {3.5794141778119345`*^9, 3.5794141891063805`*^9}, 
   3.579415089115668*^9, {3.579415479036665*^9, 3.579415528693669*^9}, {
   3.579415815792645*^9, 3.579415856682412*^9}, {3.5794159865413446`*^9, 
   3.579415992469369*^9}, {3.5794162719525137`*^9, 3.5794162807821503`*^9}, {
   3.5794340131923156`*^9, 3.5794340204473453`*^9}}]
},
WindowSize->{925, 545},
WindowMargins->{{8, Automatic}, {Automatic, 2}},
ShowSelection->True,
FrontEndVersion->"9.0 for Microsoft Windows (32-bit) (January 25, 2013)",
StyleDefinitions->"Default.nb"
]
(* End of Notebook Content *)

(* Internal cache information *)
(*CellTagsOutline
CellTagsIndex->{}
*)
(*CellTagsIndex
CellTagsIndex->{}
*)
(*NotebookFileOutline
Notebook[{
Cell[557, 20, 753, 13, 31, "Input"],
Cell[1313, 35, 419, 9, 31, "Input"],
Cell[1735, 46, 9312, 190, 732, "Input"]
}
]
*)

(* End of internal cache information *)
